<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>חדר בקרה: מנחה רשמי</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://download.agora.io/sdk/release/AgoraRTC_N.js"></script>
<script src="https://cdn.jsdelivr.net/npm/agora-rtm-sdk@1.5.1/js/AgoraRTM_N.js"></script>
    </head>
<body>
    <script src="chat.js"></script>
    <script>
        const AGORA_APP_ID = "517f71a5aa8a45a8a222341136c439c4"; // שים כאן את ה-App ID שלך

        // --- לוגיקת מסך הכניסה נשארת זהה ---
        
        async function main(displayName) {
            const rtcClient = AgoraRTC.createClient({ mode: "live", codec: "vp8" });
            rtcClient.setClientRole("host");
            const rtmClient = AgoraRTM.createInstance(AGORA_APP_ID);

            const urlParams = new URLSearchParams(window.location.search);
            const channelName = urlParams.get('channel');
            const token = urlParams.get('token'); // קריאת הטוקן מהקישור
            const uid = parseInt(urlParams.get('uid'));

            let localTracks = { mic: null, cam: null };
            
            try {
                // שימוש בטוקן מהקישור בעת ההצטרפות
                await rtcClient.join(AGORA_APP_ID, channelName, token, uid);
                await initChat(rtmClient, channelName, uid.toString(), displayName);
            } catch (error) {
                console.error("Join failed", error);
                alert("ההתחברות לערוץ נכשלה: " + error);
                return;
            }
            
            // --- כל לוגיקת הכפתורים נשארת זהה ---
        }
    </script>
</body>
</html>
