<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Player View</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; }
        #main-container { display: flex; width: 100%; height: 100%; }
        #broadcast-view { flex: 3; /* תופס 3/4 מהרוחב */ background: #000; }
        #controller-view { flex: 1; /* תופס 1/4 מהרוחב */ }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>
    <script src="https://download.agora.io/sdk/release/AgoraRTC_N.js"></script>

    <div id="main-container">
        <div id="broadcast-view"></div>
        <div id="controller-view">
            <iframe id="controller-frame"></iframe>
        </div>
    </div>

    <script>
        const APP_ID = "5c3ec68539331ff3c656"; // !!! החלף במזהה האפליקציה שלך מ-Agora

        // קבלת הפרמטרים מכתובת ה-URL
        const urlParams = new URLSearchParams(window.location.search);
        const channelName = urlParams.get('channel');
        const gameCode = urlParams.get('gamecode');

        // בניית כתובת השלט והצבתה ב-iframe
        const controllerUrl = `https://game.clicker.co.il/phone.html?code=${gameCode}`;
        document.getElementById('controller-frame').src = controllerUrl;

        const client = AgoraRTC.createClient({ mode: "live", codec: "vp8" });
        client.setClientRole("audience");

        async function joinAndSubscribe() {
            await client.join(APP_ID, channelName, null, null);

            client.on("user-published", async (user, mediaType) => {
                await client.subscribe(user, mediaType);
                if (mediaType === "video") {
                    // השידור הראשי הוא של שיתוף המסך, אז נציג אותו
                    if (user.videoTrack.getMediaStreamTrack().getSettings().displaySurface) {
                        user.videoTrack.play('broadcast-view');
                    }
                }
                if (mediaType === "audio") {
                    user.audioTrack.play();
                }
            });
        }
        joinAndSubscribe();
    </script>
</body>
</html>