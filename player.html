<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Player View</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: sans-serif; }
        #main-container { display: flex; width: 100%; height: 100%; }
        #broadcast-view { flex: 3; background: #000; }
        #controller-view { flex: 1; }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>
    <div id="main-container">
        <div id="broadcast-view"></div>
        <div id="controller-view">
            <iframe id="controller-frame"></iframe>
        </div>
    </div>

    <script src="https://download.agora.io/sdk/release/AgoraRTC_N.js"></script>
    <script>
        const APP_ID = "517f71a5aa8a45a8a222341136c439c4"; // !!! החלף במזהה האמיתי שלך

        const urlParams = new URLSearchParams(window.location.search);
        const channelName = urlParams.get('channel');
        const gameCode = urlParams.get('gamecode');

        document.getElementById('controller-frame').src = `https://game.clicker.co.il/phone.html?code=${gameCode}`;

        const client = AgoraRTC.createClient({ mode: "live", codec: "vp8" });
        client.setClientRole("audience");

        async function main() {
            await client.join(APP_ID, channelName, null, null);

            client.on("user-published", async (user, mediaType) => {
                await client.subscribe(user, mediaType);
                if (mediaType === "video") {
                    // אין צורך לבדוק סוג, פשוט מנגנים את הוידאו היחיד שמגיע
                    user.videoTrack.play('broadcast-view');
                }
                if (mediaType === "audio") {
                    user.audioTrack.play();
                }
            });
        }
        main();
    </script>
</body>
</html>
