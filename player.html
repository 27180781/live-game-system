<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <title>Player View</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://download.agora.io/sdk/release/AgoraRTC_N.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/agora-rtm-sdk@1.5.1/js/AgoraRTM_N.js"></script>
    </head>
<body>
     <script src="chat.js"></script>
    <script>
        const AGORA_APP_ID = "517f71a5aa8a45a8a222341136c439c4"; // שים כאן את ה-App ID שלך

        // --- לוגיקת מסך הכניסה נשארת זהה ---

        async function main(displayName) {
            const rtcClient = AgoraRTC.createClient({ mode: "live", codec: "vp8" });
            rtcClient.setClientRole("audience");
            const rtmClient = AgoraRTM.createInstance(AGORA_APP_ID);

            const urlParams = new URLSearchParams(window.location.search);
            const channelName = urlParams.get('channel');
            const token = urlParams.get('token');
            const gameCode = urlParams.get('gamecode');
            const officialHostUid = parseInt(urlParams.get('official_uid'));
            const technicalHostUid = parseInt(urlParams.get('tech_uid'));
            
            const myUid = Math.floor(Math.random() * 100000);
            document.getElementById('controller-frame').src = `https://game.clicker.co.il/phone.html?code=${gameCode}`;

            rtcClient.on("user-published", async (user, mediaType) => {
                // ... לוגיקת ההרשמה למנחים נשארת זהה ...
            });
            
            // שימוש בטוקן מהקישור בעת ההצטרפות
            await rtcClient.join(AGORA_APP_ID, channelName, token, null); // צופה מצטרף עם null uid
            await initChat(rtmClient, channelName, myUid.toString(), displayName);
        }
    </script>
</body>
</html>
